ok now you will wtote EVERYTHING form scrath with the new instrcturs: lets build a simple workflow ingine from scratch e2e. Nextjs with drag and drop diagram builder. server with Nestjs. db docker postgress DB tabels: worfkos. station. action. activity. workflow made from list of station. action is somthing that station doing: time, http, etc. activity is instance of workflow. list of activity are the state of a worflow. you can query all the activies with some id and you have the workflow instace. no Kafka/SQS. just triggers. exept for the time action - use kafaka. worfkow event base triger come from out side. we doing our station + action. every ststion has a trigger. evet flow event we neet to be able to implement this: workflow XYZ station 1 - triggerd by api POST workflow/XYZ. action: http. the url and data comes from the init POST request. ststion 2 - wating to hook. the system have general hook api/hook/worflow/XYZ/ststion/2 or api/hook/worflow/XYZ and in the POST body un the root { worflow_ststion:2, auther data...} station 3 - timer 30 sc. by kafka station 4 - preforn http to anuther url with the data from the hook station 3 - timer. after the hook comes - no queue exept kafaka for the timers (timeout station-action) { "workflows": [{name:"wf xyz", id: "xyz"}] "stations":[ {"id":"s1uuid","name":"S1","kind":"http","position":{"x":50,"y":100},"data":{"url": "bla", the statoin will triggerd by api/v1/workflow/XYZ. the station will send also data that it gets from the request }}, {"id":"s2uuid","name":"S2 Hook","kind":"hook","position":{"x":300,"y":100},"data":{ no neet to spesify path becous it ganaral api/v1/hook/workflow/xyz/station/2"}}, {"id":"s3uuid","name":"S3 Timer","kind":"timer","position":{"x":550,"y":100},"data":{"ms":"30000"},}, {"id":"s4uuid","name":"S4 HTTP","kind":"http","position":{"x":800,"y":100},"data":{"url": "bla", the statoin will triggerd by s3uuid->s4uuid with chain metadata } }}} {"id":"s5uuid","name":"S5 HTTP","kind":"http","position":{"x":xxx,"y":xxx},"data":{"url": "bla", the statoin will triggerd by s4uuid with chain metadata }}}} {"id":"s6uuid","name":"S6 HTTP","kind":"http","position":{"x":xxx,"y":xxx},"data":{"url": "bla", the statoin will triggerd by s4uuid with chain metadata }}}} // also supprt {"id":"sxxxuuid","name":"xxx Jion","kind":"join","position":{"x":xxx,"y":xxx},"conditions":[{"worflow_activity_state.data.someparam":"4"}, {"worflow_activity_state.data.someotherparam":"7"]: }}}} ], "edges":[ {"from":"s2uuid","to":"s3uuid","kind":"normal"}, {"from":"s3uuid","to":"s4uuid","type":"normal"}, {"from":"s4uuid","to":"s5uuid","type":"if", condition: "activity_metadata.body.someparam = 5"} {"from":"s4uuid","to":"s6uuid","type":"if", condition: "activity_metadata.body.someparam = 6"} // we also will have loop adge ] }

action table will coled _action


we not using settimeout but rabbit with retation time